import { chromium } from "playwright-core";export default async function handler(req,res){if(req.method!=="POST")return res.status(405).send("Method not allowed");const {url,depth="balanced"}=req.body;if(!url)return res.status(400).json({error:"Missing URL"});try{const browser=await chromium.launch({args:["--no-sandbox","--disable-setuid-sandbox"],headless:true});const page=await browser.newPage({userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",viewport:{width:1280,height:900}});await page.goto(url,{waitUntil:"networkidle",timeout:60000});const tree=await page.evaluate(()=>{const parse=(el)=>{const cs=getComputedStyle(el);const box=el.getBoundingClientRect();return{tag:el.tagName.toLowerCase(),text:el.textContent.trim()||null,style:{color:cs.color,background:cs.backgroundColor,fontSize:cs.fontSize,fontWeight:cs.fontWeight,borderRadius:cs.borderRadius},box:{width:box.width,height:box.height},children:[...el.children].map(parse)}};return{meta:{title:document.title},root:parse(document.body)}});await browser.close();res.setHeader("Content-Disposition",'attachment; filename="web_to_figma.fig.json"');return res.status(200).json(tree)}catch(error){console.error(error);return res.status(500).json({error:error.message})}}